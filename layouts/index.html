{{ define "main" }}
<section class="h-feed">
    {{- $list := where .Site.Pages.ByDate.Reverse ".Params.photos" "!=" nil -}}
	{{ range $index, $value := $list }}
        {{ if eq $index 0 }}
            {{ range first 1 .Params.photos }}
            <style>
                .cover {
                    background: radial-gradient(circle farthest-corner at 80% 20%, hsl(150 80% 20% / .3) 0%, hsl(170 60% 10% / .1) 100%),
                        hsl(231, 32%, 29%) url("{{ . }}") 50% / cover;
                }
            </style>
            {{ end }}
        {{ end }}
	{{ end }}

    
    {{ range where .Site.Pages "Type" "post" }}
        {{ if eq (.Date.Format "2006") ($.Scratch.Get "mostRecentYear") }}
        <article class="h-entry">
            {{ if .Title }}
                <div class="post">
                    <h1 class="p-name">
                        <a class="u-url" href="{{ .Permalink }}#1">{{ .Title }}</a>
                    </h1>
                    <time class="dt-published" datetime="{{ .Date.Format "2006-01-02T15:04:05-0700" }}">
                        {{ .Date.Format "02 Jan 2006" }}
                    </time>
                </div>
                {{ $truncatedContent := .Content | safeHTML | strings.Truncate 300 }}
                {{ $truncatedContent }}
                {{ if .Truncated }}
                    <a href="{{ .Permalink }}#1" class="read-more">Read more</a>
                {{ end }}
            {{ else }}
                <div class="post">
                    <h1 class="p-name">
                        <a class="u-url" href="{{ .Permalink }}#1">
                            <time class="dt-published" datetime="{{ .Date.Format "2006-01-02T15:04:05-0700" }}">
                                {{ .Date.Format "02 Jan 2006" }}
                            </time>
                        </a>
                    </h1>
                    {{ $truncatedContent := .Content | safeHTML | strings.Truncate 400 }}
                    {{ $truncatedContent }}
                    {{ if .Truncated }}
                        <a href="{{ .Permalink }}#1" class="read-more">Read more</a>
                    {{ end }}
                </div>
            {{ end }}
        </article>
        {{ end }}
    {{ end }}
</section>
{{ end }}